<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LFJC Online Exam - Full Screen Secure</title>
<style>
/* ===== BASE STYLES ===== */
:root {
  --primary-color: #4B0082;
  --secondary-color: #D8BFD8;
  --light-purple: #E6E6FA;
  --white: #fff;
  --black: #000;
  --success: #32CD32;
  --warning: #ff9900;
  --danger: #ff6666;
  --shadow: 0 5px 15px rgba(0,0,0,0.1);
  --transition: all 0.3s ease;
}

* {
  box-sizing: border-box;
}

body {
  font-family: "SF Pro Display", Arial, sans-serif;
  margin: 0;
  background: var(--white);
  color: var(--black);
  line-height: 1.6;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* ===== FULL SCREEN SECURITY OVERLAY ===== */
#fullscreenSecurityModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  z-index: 2147483647;
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  color: white;
  text-align: center;
  padding: 20px;
}

#fullscreenSecurityModal div {
  background: linear-gradient(135deg, #8B0000, #DC143C);
  padding: 40px;
  border-radius: 15px;
  border: 3px solid #FFD700;
  max-width: 600px;
  box-shadow: 0 0 50px rgba(255, 0, 0, 0.5);
  animation: pulseModal 2s infinite;
}

#fullscreenSecurityModal h1 {
  color: #FFD700;
  font-size: 36px;
  margin-bottom: 20px;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

#fullscreenSecurityModal p {
  font-size: 20px;
  margin-bottom: 30px;
}

#fullscreenLockOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #4B0082, #8A2BE2);
  z-index: 2147483648;
  display: none;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 32px;
  font-weight: bold;
  text-align: center;
  flex-direction: column;
  gap: 20px;
}

@keyframes pulseModal {
  0% { transform: scale(1); box-shadow: 0 0 50px rgba(255, 0, 0, 0.5); }
  50% { transform: scale(1.02); box-shadow: 0 0 70px rgba(255, 0, 0, 0.7); }
  100% { transform: scale(1); box-shadow: 0 0 50px rgba(255, 0, 0, 0.5); }
}

/* ===== SECURITY WARNING ===== */
.security-warning {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 999999;
  display: none;
  justify-content: center;
  align-items: center;
}

.security-warning-content {
  background: white;
  padding: 30px;
  border-radius: 10px;
  text-align: center;
  max-width: 500px;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ===== SCREENSHOT PROTECTION ===== */
#screenshotProtection {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: transparent;
  z-index: 2147483647;
  pointer-events: none;
}

.screenshot-dots {
  position: absolute;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 10% 20%, rgba(255,255,255,0.02) 1px, transparent 1px),
    radial-gradient(circle at 30% 40%, rgba(255,255,255,0.02) 1px, transparent 1px),
    radial-gradient(circle at 50% 60%, rgba(255,255,255,0.02) 1px, transparent 1px),
    radial-gradient(circle at 70% 80%, rgba(255,255,255,0.02) 1px, transparent 1px),
    radial-gradient(circle at 90% 10%, rgba(255,255,255,0.02) 1px, transparent 1px);
  background-size: 200px 200px;
  animation: flicker 0.5s infinite;
}

@keyframes flicker {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 0.9; }
}

/* ===== ACCESS DENIED SCREEN ===== */
.access-denied {
  display: flex;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #4B0082, #8A2BE2);
  z-index: 10000;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: white;
  text-align: center;
  padding: 20px;
}

.access-denied h1 {
  font-size: 3em;
  margin-bottom: 20px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.access-code-input {
  padding: 12px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  width: 300px;
  text-align: center;
  margin-bottom: 20px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.verify-btn {
  background: white;
  color: #4B0082;
  border: none;
  padding: 12px 30px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s ease;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.verify-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 8px rgba(0,0,0,0.15);
}

.access-error {
  color: #ffeb3b;
  margin-top: 10px;
  font-weight: 600;
  display: none;
}

/* ===== HEADER & FOOTER ===== */
header {
  background: linear-gradient(145deg, var(--light-purple), var(--secondary-color));
  color: var(--primary-color);
  text-align: center;
  padding: 20px;
  font-size: 36px;
  font-weight: 700;
  letter-spacing: 1.5px;
  box-shadow: var(--shadow);
  text-shadow: 0 1px 2px var(--white);
}

footer {
  background: var(--light-purple);
  color: var(--primary-color);
  padding: 10px;
  text-align: center;
  font-weight: bold;
  position: fixed;
  width: 100%;
  bottom: 0;
}

/* ===== STUDENT ENTRY SECTION ===== */
#studentEntry {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 140px);
  padding: 16px;
  text-align: center;
}

.form-group {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  margin-bottom: 60px;
  width: 100%;
  max-width: 500px;
}

.form-group label {
  font-size: 1.15rem;
  font-weight: 600;
  margin-right: 10px;
  color: var(--primary-color);
  width: 180px;
  text-align: right;
}

input[type="text"], input[type="number"] {
  padding: 12px 14px;
  font-size: 1.1rem;
  border-radius: 10px;
  border: 1.5px solid var(--primary-color);
  outline: none;
  min-width: 250px;
  transition: var(--transition);
}

input[type="text"]:focus, input[type="number"]:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(75, 0, 130, 0.2);
}

input.error {
  animation: glowRed 0.5s alternate infinite;
  border-color: var(--danger);
}

@keyframes glowRed {
  0% { box-shadow: 0 0 5px var(--danger); }
  100% { box-shadow: 0 0 15px var(--danger); }
}

/* ===== BUTTON STYLES ===== */
button {
  position: relative;
  overflow: hidden;
  cursor: pointer;
  border: none;
  border-radius: 12px;
  transition: var(--transition);
  box-shadow: 0 6px #aaa;
  background: linear-gradient(to bottom, #fafaff, #dcd6f7);
  color: var(--primary-color);
  font-weight: 600;
  padding: 12px 24px;
  font-size: 18px;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 15px rgba(0,0,0,.28);
}

button:active {
  transform: translateY(3px) scale(.98);
}

button:focus {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
}

.optBtn {
  font-size: 16px;
  padding: 8px 18px;
  margin: 6px;
  border: 2px solid var(--primary-color);
  background: var(--white);
  border-radius: 8px;
  box-shadow: 0 5px #aaa;
}

.optBtn.selected {
  background: var(--success);
  color: var(--white);
  border-color: #2fa92f;
}

.optBtn.correct {
  background: #32CD32;
  color: white;
  border-color: #228B22;
}

.optBtn.wrong {
  background: #FF6B6B;
  color: white;
  border-color: #DC143C;
}

.optBtn.not-attempted {
  background: #B0B0B0;
  color: white;
  border-color: #808080;
}

.navBtn {
  font-size: 16px;
  padding: 10px 20px;
  border-radius: 8px;
  color: var(--white);
  font-weight: bold;
  cursor: pointer;
  background: linear-gradient(145deg, #1E90FF, #4682B4);
  margin: 0 15px;
}

#markReviewBtn {
  background: linear-gradient(145deg, #ffb84d, var(--warning));
}

#submitBtn {
  background: linear-gradient(145deg, #c8b88a, #b49e60);
}

/* ===== TIMER STYLES ===== */
#timerEl {
  font-size: 20px;
  font-weight: bold;
  color: var(--primary-color);
  padding: 6px 12px;
  border-radius: 6px;
  background: #f0f0ff;
  display: inline-block;
  transition: var(--transition);
}

#timerEl.blink {
  animation: blinkTimer 1s infinite;
}

@keyframes blinkTimer {
  0% { background: var(--danger); color: var(--white); }
  50% { background: var(--white); color: var(--primary-color); }
  100% { background: var(--danger); color: var(--white); }
}

/* ===== PALETTE STYLES ===== */
#paletteContainer {
  display: grid;
  gap: 8px;
  margin: 20px auto;
  max-width: 100%;
  padding: 0 10px;
  justify-content: center;
}

#paletteContainer button {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 14px;
  margin: 2px;
  border: 1px solid var(--primary-color);
  background: var(--light-purple);
  color: var(--primary-color);
  display: flex;
  align-items: center;
  justify-content: center;
}

#paletteContainer button.selected {
  background: var(--success);
  color: var(--white);
  border-color: #2fa92f;
}

#paletteContainer button.reviewed {
  background: yellow;
  color: var(--black);
}

#paletteContainer button.current {
  border: 3px solid red;
}

#paletteContainer button.correct-answer {
  background: #32CD32;
  color: white;
}

#paletteContainer button.wrong-answer {
  background: #FF6B6B;
  color: white;
}

#paletteContainer button.not-attempted-answer {
  background: #B0B0B0;
  color: white;
}

/* ===== EXAM AREA STYLES ===== */
#examArea {
  padding: 16px;
  text-align: center;
  display: none;
}

#examHeader {
  display: flex;
  align-items: center;
  width: 100%;
  font-weight: bold;
  margin-bottom: 20px;
}

#stuInfo {
  flex: 0 0 auto;
  text-align: left;
  white-space: nowrap;
}

#stuQInfo {
  flex: 1;
  text-align: center;
  white-space: nowrap;
}

.sectionTitle {
  font-size: 22px;
  color: var(--primary-color);
  font-weight: bold;
  margin-bottom: 8px;
}

/* ===== QUESTION IMAGE STYLES ===== */
.questionImg {
  max-width: 100%;
  height: auto;
  border-radius: 10px;
  display: block;
  margin: 0 auto;
  border: 2px solid #E6E6FA;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.image-error {
  background: #ffebee;
  border: 2px solid #ffcdd2;
  color: #c62828;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
  text-align: center;
  font-weight: bold;
}

.image-error h3 {
  margin: 0 0 10px 0;
  color: #c62828;
}

/* ===== SUMMARY & REVIEW AREAS ===== */
#summaryArea, #reviewArea {
  display: none;
  padding: 20px;
}

.area-header {
  text-align: center;
  margin-bottom: 30px;
}

.area-header h2 {
  color: #4B0082;
  margin-bottom: 10px;
}

/* ===== MODAL STYLES ===== */
.confirmModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10001;
}

.confirmBox {
  background: var(--white);
  padding: 20px;
  border-radius: 12px;
  min-width: 280px;
  text-align: center;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.confirmBox p {
  font-size: 18px;
  color: var(--primary-color);
  margin-bottom: 15px;
}

.confirmBox button {
  margin: 0 10px;
  padding: 8px 16px;
  font-size: 16px;
  cursor: pointer;
}

/* ===== RESPONSIVE STYLES ===== */
@media (max-width: 600px) {
  .form-group {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .form-group label {
    text-align: left;
    width: auto;
    margin-bottom: 5px;
  }
  
  #examHeader {
    flex-direction: column;
    gap: 10px;
  }
  
  .navContainer {
    flex-direction: column;
    align-items: center;
  }
  
  .navBtn {
    width: 80%;
    margin-bottom: 10px;
    margin-left: 0;
    margin-right: 0;
  }
}

/* ===== NUMERICAL KEYPAD ===== */
.numerical-keypad {
  margin: 25px auto;
  max-width: 320px;
}

.keypad-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 15px;
  border: 2px solid #4B0082;
  box-shadow: 0 8px 16px rgba(75, 0, 130, 0.1);
}

.num-key-btn {
  width: 70px;
  height: 70px;
  font-size: 28px;
  font-weight: bold;
  border: 3px solid #4B0082;
  border-radius: 15px;
  background: linear-gradient(145deg, #ffffff, #f0f0ff);
  color: #4B0082;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 6px 0 rgba(75, 0, 130, 0.2);
}

.num-key-btn:hover {
  background: linear-gradient(145deg, #f0f0ff, #e6e6fa);
  transform: translateY(-3px);
  box-shadow: 0 8px 0 rgba(75, 0, 130, 0.3);
}

/* ===== PREVENT TEXT SELECTION ===== */
.prevent-select {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* ===== ANTI-SCREENSHOT ===== */
.anti-screenshot {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2147483646;
  background: 
    repeating-linear-gradient(
      0deg,
      rgba(255, 255, 255, 0.01) 0px,
      rgba(255, 255, 255, 0.01) 1px,
      transparent 1px,
      transparent 2px
    );
  opacity: 0.1;
}

/* ===== TAB SWITCH WARNING ===== */
.tab-switch-warning {
  position: fixed;
  top: 10px;
  right: 10px;
  background: rgba(255, 0, 0, 0.8);
  color: white;
  padding: 10px 15px;
  border-radius: 5px;
  z-index: 10000;
  animation: slideIn 0.3s ease;
  display: none;
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOut {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}
</style>
</head>

<body class="prevent-select">

<!-- ACCESS DENIED SCREEN (FIRST SCREEN) -->
<div id="accessDenied" class="access-denied">
    <h1>LFJC ONLINE EXAMINATION</h1>
    <p style="font-size: 1.2em; margin: 10px 0;">TOTAL 75 QUESTIONS</p>
    <p style="margin: 5px 0;">‚Ä¢ Maths: Q1-20 (MCQ), Q21-25 (Numerical Input)</p>
    <p style="margin: 5px 0;">‚Ä¢ Physics: Q26-45 (MCQ), Q46-50 (Numerical Input)</p>
    <p style="margin: 5px 0;">‚Ä¢ Chemistry: Q51-70 (MCQ), Q71-75 (Numerical Input)</p>
    <p style="margin: 10px 0; font-weight: bold;">CORRECT ANSWER + 4 MARKS</p>
    <p style="margin: 5px 0; font-weight: bold;">WRONG ANSWER -1 MARK</p>
    <input type="password" id="accessCode" class="access-code-input" placeholder="Enter Access Code">
    <button id="verifyAccess" class="verify-btn">VERIFY ACCESS</button>
    <div id="accessError" class="access-error">‚ùå Invalid access code. Please try again.</div>
</div>

<header>LFJC ONLINE EXAMINATION</header>

<!-- STUDENT ENTRY -->
<div id="studentEntry" style="display:none;">
  <div class="form-group"><label>NAME</label><input type="text" id="stuName" placeholder="Only letters & spaces" autocomplete="off"></div>
  <div class="form-group"><label>SECTION</label><input type="text" id="stuSection" placeholder="Letters & digits" autocomplete="off"></div>
  <div class="form-group"><label>ROLL NUMBER</label><input type="text" id="stuRoll" placeholder="Digits only" autocomplete="off"></div>
  <div class="form-group"><label>ADMISSION NUMBER</label><input type="text" id="stuAdm" placeholder="Digits only" autocomplete="off"></div>
  
  <div class="form-group"><button id="stuStartBtn" style="display:none;">Start Exam</button></div>
  <p id="studentMsg"></p>
  <div id="errorMessages"></div>
</div>

<!-- EXAM AREA -->
<div id="examArea" style="display:none;">
  <div id="examHeader" style="display:flex;align-items:center;width:100%;font-weight:bold;">
    <div id="stuInfo" style="flex:0 0 auto;text-align:left; white-space:nowrap;"></div>
    <div id="stuQInfo" style="flex:1;text-align:center; white-space:nowrap;"></div>
    <div style="flex:0 0 auto;text-align:right; white-space:nowrap;">
        <span id="timerEl">üïí 00:00</span>
    </div>
  </div>

  <div id="questionContainer" style="text-align:center;margin-top:10px;"></div>

  <div class="navContainer">
    <button class="navBtn" id="prevBtn">‚¨Ö Previous</button>
    <button class="navBtn" id="markReviewBtn">Review</button>
    <button class="navBtn" id="nextBtn">Next ‚û°</button>
    <button class="navBtn" id="submitBtn">Submit Exam</button>
  </div>

  <div id="paletteContainer"></div>
</div>

<!-- SUMMARY AREA -->
<div id="summaryArea">
  <div class="area-header">
    <h2>üìä Exam Summary - <span id="summaryStudentName"></span></h2>
  </div>
  
  <div id="summaryTableContainer" style="overflow-x:auto;display:flex;justify-content:center;width:100%;"></div>
  
  <div style="text-align:center; margin:30px 0;">
    <button id="closeSummaryBtn" class="navBtn" style="background:linear-gradient(145deg, #dc3545, #c82333);">Close</button>
  </div>
</div>

<!-- SECURITY OVERLAYS -->
<div id="fullscreenSecurityModal">
  <div>
    <h1>‚ö†Ô∏è SECURITY WARNING ‚ö†Ô∏è</h1>
    <p id="securityMessage">Full-screen mode is required for this exam</p>
    <div style="background: rgba(0, 0, 0, 0.5); padding: 20px; border-radius: 10px; margin-bottom: 30px;">
      <p style="font-size: 18px;">You exited full-screen mode. Returning to full-screen...</p>
      <p style="font-size: 16px; color: #FFD700;" id="violationCounter">Violations: 0/3</p>
    </div>
    <button id="returnToFullscreen">Return to Full Screen</button>
  </div>
</div>

<div id="fullscreenLockOverlay">
  <div style="font-size: 48px; margin-bottom: 20px;">üõ°Ô∏è</div>
  <div>SECURITY VIOLATION DETECTED</div>
  <div style="font-size: 24px; margin-top: 10px;">Exam will be submitted automatically</div>
</div>

<!-- SCREENSHOT PROTECTION -->
<div id="screenshotProtection">
  <div class="screenshot-dots"></div>
</div>

<!-- TAB SWITCH WARNING -->
<div id="tabSwitchWarning" class="tab-switch-warning">
  ‚ö†Ô∏è Tab switching detected!
</div>

<!-- ANTI-SCREENSHOT OVERLAY -->
<div class="anti-screenshot"></div>

<footer>@LFJC2025 All Rights Reserved</footer>

<script>
// ===== CONFIGURATION =====
const ACCESS_CODE = "lfjc2025";
const EXAM_DURATION_MINUTES = 180;
const MAX_QUESTIONS = 75;

// ===== FULL-SCREEN SECURITY SYSTEM =====
class FullScreenSecurity {
    constructor() {
        this.securityActive = false;
        this.fullScreenCheckInterval = null;
        this.violationCount = 0;
        this.maxViolations = 3;
        this.tabSwitchCount = 0;
        this.maxTabSwitches = 2;
        this.lastTabSwitchTime = 0;
        this.tabSwitchWindow = 30000; // 30 seconds
    }
    
    async enable() {
        console.log('üîí Enabling full-screen security...');
        this.securityActive = true;
        
        // Request full screen
        await this.requestFullScreen();
        
        // Setup event listeners
        this.setupEventListeners();
        
        // Start periodic checking
        this.startFullScreenCheck();
        
        // Enable screenshot protection
        this.enableScreenshotProtection();
        
        console.log('‚úÖ Full-screen security enabled');
    }
    
    async requestFullScreen() {
        try {
            const elem = document.documentElement;
            
            if (elem.requestFullscreen) {
                await elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                await elem.webkitRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                await elem.mozRequestFullScreen();
            } else if (elem.msRequestFullscreen) {
                await elem.msRequestFullscreen();
            }
            
            console.log('‚úÖ Entered full-screen mode');
            
        } catch (err) {
            console.error('‚ùå Failed to enter full-screen:', err);
            this.showSecurityWarning('Please allow full-screen mode to start the exam');
        }
    }
    
    setupEventListeners() {
        // Fullscreen change detection
        document.addEventListener('fullscreenchange', () => this.handleFullScreenChange());
        document.addEventListener('webkitfullscreenchange', () => this.handleFullScreenChange());
        document.addEventListener('mozfullscreenchange', () => this.handleFullScreenChange());
        document.addEventListener('MSFullscreenChange', () => this.handleFullScreenChange());
        
        // Keyboard shortcuts blocking
        document.addEventListener('keydown', (e) => this.handleKeyDown(e));
        
        // Tab switch detection
        document.addEventListener('visibilitychange', () => this.handleVisibilityChange());
        
        // Prevent right-click
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            return false;
        });
    }
    
    handleFullScreenChange() {
        const isFullScreen = document.fullscreenElement || 
                             document.webkitFullscreenElement || 
                             document.mozFullScreenElement ||
                             document.msFullscreenElement;
        
        if (!isFullScreen && this.securityActive) {
            console.log('‚ö†Ô∏è Full-screen exited');
            this.violationCount++;
            
            if (this.violationCount >= this.maxViolations) {
                this.handleSecurityViolation();
            } else {
                this.showSecurityModal();
                setTimeout(() => this.requestFullScreen(), 2000);
            }
        } else if (isFullScreen) {
            console.log('‚úÖ Full-screen active');
            document.getElementById('fullscreenSecurityModal').style.display = 'none';
        }
    }
    
    startFullScreenCheck() {
        this.fullScreenCheckInterval = setInterval(() => {
            const isFullScreen = document.fullscreenElement || 
                                 document.webkitFullscreenElement || 
                                 document.mozFullScreenElement ||
                                 document.msFullscreenElement;
            
            if (!isFullScreen && this.securityActive) {
                console.log('‚ö†Ô∏è Periodic check: Not in full-screen');
                this.violationCount++;
                
                if (this.violationCount >= this.maxViolations) {
                    this.handleSecurityViolation();
                } else {
                    this.requestFullScreen();
                }
            }
        }, 1000);
    }
    
    showSecurityModal() {
        const modal = document.getElementById('fullscreenSecurityModal');
        document.getElementById('violationCounter').textContent = 
            `Violations: ${this.violationCount}/${this.maxViolations}`;
        modal.style.display = 'flex';
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            }
        }, 5000);
    }
    
    handleSecurityViolation() {
        console.log('üö® Security violation - submitting exam');
        clearInterval(this.fullScreenCheckInterval);
        
        // Show lock overlay
        document.getElementById('fullscreenLockOverlay').style.display = 'flex';
        
        // Submit exam after delay
        setTimeout(() => {
            if (typeof submitExam === 'function' && examInProgress) {
                submitExam();
            }
        }, 3000);
    }
    
    handleKeyDown(e) {
        // Block F11 and Escape during exam
        if (this.securityActive && examInProgress && (e.key === 'F11' || e.key === 'Escape')) {
            e.preventDefault();
            e.stopPropagation();
            console.log(`üîí Blocked ${e.key} key`);
            this.violationCount++;
            this.showSecurityModal();
            return false;
        }
        
        // Block Print Screen
        if (e.key === 'PrintScreen' || (e.ctrlKey && e.key === 'p')) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    }
    
    handleVisibilityChange() {
        if (document.hidden && this.securityActive && examInProgress) {
            const currentTime = Date.now();
            
            // Reset count if window has passed
            if (currentTime - this.lastTabSwitchTime > this.tabSwitchWindow) {
                this.tabSwitchCount = 0;
            }
            
            this.tabSwitchCount++;
            this.lastTabSwitchTime = currentTime;
            
            console.log(`Tab switch detected: ${this.tabSwitchCount}/${this.maxTabSwitches}`);
            
            if (this.tabSwitchCount >= this.maxTabSwitches) {
                this.handleSecurityViolation();
            } else {
                this.showTabSwitchWarning();
            }
        }
    }
    
    showTabSwitchWarning() {
        const warning = document.getElementById('tabSwitchWarning');
        warning.textContent = `‚ö†Ô∏è Tab switching detected! (${this.tabSwitchCount}/${this.maxTabSwitches})`;
        warning.style.display = 'block';
        
        setTimeout(() => {
            warning.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => {
                warning.style.display = 'none';
                warning.style.animation = '';
            }, 300);
        }, 3000);
    }
    
    enableScreenshotProtection() {
        // Screenshot protection is already in the HTML
        document.getElementById('screenshotProtection').style.display = 'block';
    }
    
    disable() {
        this.securityActive = false;
        
        // Clear intervals
        clearInterval(this.fullScreenCheckInterval);
        
        // Hide security elements
        document.getElementById('fullscreenSecurityModal').style.display = 'none';
        document.getElementById('fullscreenLockOverlay').style.display = 'none';
        document.getElementById('tabSwitchWarning').style.display = 'none';
        document.getElementById('screenshotProtection').style.display = 'none';
        
        // Exit full screen
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        
        console.log('üîì Security system disabled');
    }
}

// Initialize security system
const examSecurity = new FullScreenSecurity();

// ===== GLOBAL VARIABLES =====
let examInProgress = false;
let hasSubmitted = false;
let examStartTime = null;
let timerInterval = null;
let progress = null;
let examData = {
    files: [],
    subjectNames: [],
    keys: [],
    originalOrder: [],
    questionTypes: []
};

// ===== ACCESS CODE VERIFICATION =====
function verifyAccessCode() {
    const enteredCode = document.getElementById('accessCode').value.trim();
    const errorElement = document.getElementById('accessError');
    const accessDenied = document.getElementById('accessDenied');
    
    errorElement.style.display = 'none';
    
    if (enteredCode === ACCESS_CODE) {
        accessDenied.style.display = 'none';
        document.getElementById('studentEntry').style.display = 'flex';
        document.getElementById('accessCode').value = '';
        document.getElementById('stuName').focus();
    } else {
        errorElement.style.display = 'block';
        document.getElementById('accessCode').value = '';
        document.getElementById('accessCode').focus();
        accessDenied.style.animation = 'shake 0.5s';
        setTimeout(() => accessDenied.style.animation = '', 500);
    }
}

// ===== STUDENT VALIDATION =====
function validateStudentInputs() {
    const n = document.getElementById('stuName');
    const s = document.getElementById('stuSection');
    const r = document.getElementById('stuRoll');
    const a = document.getElementById('stuAdm');
    
    if (s.value) s.value = s.value.toUpperCase();
    
    const v1 = /^[A-Za-z .]+$/.test(n.value);
    const v2 = /^[A-Za-z0-9]+$/.test(s.value);
    const v3 = /^[0-9]+$/.test(r.value);
    const v4 = /^[0-9]+$/.test(a.value);
    
    n.classList.toggle('error', !v1 && n.value !== "");
    s.classList.toggle('error', !v2 && s.value !== "");
    r.classList.toggle('error', !v3 && r.value !== "");
    a.classList.toggle('error', !v4 && a.value !== "");
    
    const allValid = v1 && v2 && v3 && v4;
    document.getElementById('stuStartBtn').style.display = allValid ? "inline-block" : "none";
    
    return allValid;
}

// ===== START EXAM WITH SECURITY =====
async function startExamWithSecurity() {
    console.log('üöÄ Starting exam with security...');
    
    // Enable security first
    await examSecurity.enable();
    
    // Then start the exam
    startExam();
}

function startExam() {
    const stuName = document.getElementById('stuName');
    const stuSection = document.getElementById('stuSection');
    const stuRoll = document.getElementById('stuRoll');
    const stuAdm = document.getElementById('stuAdm');
    
    // Initialize exam data (demo data for example)
    initializeDemoData();
    prepareExamData();
    
    progress = {
        answers: Array(MAX_QUESTIONS).fill(null),
        review: Array(MAX_QUESTIONS).fill(false),
        currentIndex: 0,
        student: {
            name: stuName.value,
            sec: stuSection.value,
            roll: stuRoll.value,
            adm: stuAdm.value
        },
        timeLeftSec: EXAM_DURATION_MINUTES * 60
    };
    
    examStartTime = Date.now();
    examInProgress = true;
    
    document.getElementById('studentEntry').style.display = "none";
    document.getElementById('examArea').style.display = "block";
    renderQuestion();
    renderPalette();
    startTimer();
    updateNavButtons();
    
    console.log('‚úÖ Exam started');
}

// ===== DEMO DATA (REPLACE WITH REAL DATA) =====
function initializeDemoData() {
    // Create demo answer key for 75 questions
    answerKey = [];
    for (let i = 1; i <= MAX_QUESTIONS; i++) {
        if (i <= 20 || (i >= 26 && i <= 45) || (i >= 51 && i <= 70)) {
            // MCQ questions (A-D)
            const options = ['A', 'B', 'C', 'D'];
            answerKey.push(options[Math.floor(Math.random() * options.length)]);
        } else {
            // Numerical input questions
            answerKey.push(String(Math.floor(Math.random() * 100) + 1));
        }
    }
    
    // Generate image paths for 75 questions
    images = [];
    for (let i = 1; i <= MAX_QUESTIONS; i++) {
        images.push(`questions/${i}.png`);
    }
}

function prepareExamData() {
    // Prepare shuffled exam data
    // ... (your existing logic)
}

// ===== QUESTION RENDERING =====
function renderQuestion() {
    const idx = progress.currentIndex;
    const container = document.getElementById('questionContainer');
    
    // Demo question
    container.innerHTML = `
        <div class="question-container">
            <div class="question-number">Question ${idx + 1} of ${MAX_QUESTIONS}</div>
            <div class="question-text">
                This is a sample question. In the actual exam, questions will be loaded from image files.
            </div>
            <div class="options-container">
                <button class="optBtn ${progress.answers[idx] === 'A' ? 'selected' : ''}" 
                        data-opt="A" onclick="selectOption('A')">A</button>
                <button class="optBtn ${progress.answers[idx] === 'B' ? 'selected' : ''}" 
                        data-opt="B" onclick="selectOption('B')">B</button>
                <button class="optBtn ${progress.answers[idx] === 'C' ? 'selected' : ''}" 
                        data-opt="C" onclick="selectOption('C')">C</button>
                <button class="optBtn ${progress.answers[idx] === 'D' ? 'selected' : ''}" 
                        data-opt="D" onclick="selectOption('D')">D</button>
            </div>
        </div>
    `;
    
    updateQuestionInfo();
    updatePalette();
}

function selectOption(opt) {
    const idx = progress.currentIndex;
    if (progress.answers[idx] === opt) {
        progress.answers[idx] = null;
    } else {
        progress.answers[idx] = opt;
    }
    updateOptionButtons();
    updatePalette();
}

function updateOptionButtons() {
    const idx = progress.currentIndex;
    const currentAnswer = progress.answers[idx];
    document.querySelectorAll('.optBtn').forEach(btn => {
        const btnOpt = btn.getAttribute('data-opt');
        btn.classList.toggle('selected', btnOpt === currentAnswer);
    });
}

function updateQuestionInfo() {
    const idx = progress.currentIndex;
    const stuInfoEl = document.getElementById('stuInfo');
    const stuQInfoEl = document.getElementById('stuQInfo');
    
    if (stuInfoEl) stuInfoEl.textContent = `${progress.student.name} | ${progress.student.sec} | Roll: ${progress.student.roll}`;
    if (stuQInfoEl) stuQInfoEl.textContent = `Q${idx+1} of ${MAX_QUESTIONS}`;
}

// ===== PALETTE FUNCTIONS =====
function renderPalette() {
    const container = document.getElementById('paletteContainer');
    container.innerHTML = '';
    
    for (let i = 0; i < MAX_QUESTIONS; i++) {
        const btn = document.createElement('button');
        btn.className = 'palette-btn';
        btn.textContent = i + 1;
        btn.tabindex = "0";
        
        if (progress.answers[i] !== null) btn.classList.add('selected');
        if (progress.review[i]) btn.classList.add('reviewed');
        if (i === progress.currentIndex) btn.classList.add('current');
        
        btn.onclick = () => {
            progress.currentIndex = i;
            renderQuestion();
            updateNavButtons();
        };
        
        container.appendChild(btn);
    }
}

function updatePalette() {
    const buttons = document.querySelectorAll('.palette-btn');
    buttons.forEach((btn, i) => {
        btn.className = 'palette-btn';
        if (progress.answers[i] !== null) btn.classList.add('selected');
        if (progress.review[i]) btn.classList.add('reviewed');
        if (i === progress.currentIndex) btn.classList.add('current');
    });
}

// ===== NAVIGATION =====
function updateNavButtons() {
    const idx = progress.currentIndex;
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const markReviewBtn = document.getElementById('markReviewBtn');
    
    prevBtn.disabled = idx === 0;
    nextBtn.disabled = idx === MAX_QUESTIONS - 1;
    
    if (progress.review[idx]) {
        markReviewBtn.textContent = 'Unmark Review';
        markReviewBtn.style.background = 'linear-gradient(145deg, #dc3545, #c82333)';
    } else {
        markReviewBtn.textContent = 'Mark for Review';
        markReviewBtn.style.background = 'linear-gradient(145deg, #ffb84d, var(--warning))';
    }
}

document.getElementById('prevBtn').onclick = () => {
    if (progress.currentIndex > 0) {
        progress.currentIndex--;
        renderQuestion();
        updateNavButtons();
    }
};

document.getElementById('nextBtn').onclick = () => {
    if (progress.currentIndex < MAX_QUESTIONS - 1) {
        progress.currentIndex++;
        renderQuestion();
        updateNavButtons();
    }
};

document.getElementById('markReviewBtn').onclick = () => {
    const idx = progress.currentIndex;
    progress.review[idx] = !progress.review[idx];
    updateNavButtons();
    updatePalette();
};

// ===== TIMER =====
function startTimer() {
    timerInterval = setInterval(() => {
        progress.timeLeftSec--;
        
        const minutes = Math.floor(progress.timeLeftSec / 60);
        const seconds = progress.timeLeftSec % 60;
        const timerEl = document.getElementById('timerEl');
        
        timerEl.textContent = `üïí ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (progress.timeLeftSec <= 300) timerEl.classList.add('blink');
        
        if (progress.timeLeftSec <= 0) {
            clearInterval(timerInterval);
            submitExam();
        }
    }, 1000);
}

// ===== SUBMIT EXAM =====
function submitExam() {
    if (hasSubmitted) return;
    
    clearInterval(timerInterval);
    hasSubmitted = true;
    examInProgress = false;
    
    // Disable security
    examSecurity.disable();
    
    // Calculate results
    const subjData = calculateResults();
    
    // Show summary
    showSummaryInterface(subjData);
    
    console.log('‚úÖ Exam submitted');
}

function calculateResults() {
    // Demo calculation
    return {
        'Mathematics': { correct: 15, wrong: 5, blank: 0, total: 20, marks: 55 },
        'Physics': { correct: 12, wrong: 8, blank: 0, total: 20, marks: 40 },
        'Chemistry': { correct: 18, wrong: 2, blank: 0, total: 20, marks: 70 },
        'Total': { correct: 45, wrong: 15, blank: 15, total: 75, marks: 165 }
    };
}

// ===== SUMMARY INTERFACE =====
function showSummaryInterface(subjData) {
    document.getElementById('examArea').style.display = 'none';
    document.getElementById('summaryArea').style.display = 'block';
    
    document.getElementById('summaryStudentName').textContent = progress.student.name;
    
    // Create summary table
    const table = document.createElement('table');
    table.className = 'results-table';
    table.innerHTML = `
        <thead>
            <tr>
                <th>Subject</th>
                <th>Correct</th>
                <th>Wrong</th>
                <th>Blank</th>
                <th>Total</th>
                <th>Marks</th>
            </tr>
        </thead>
        <tbody>
            ${Object.entries(subjData).map(([subject, data]) => `
                <tr>
                    <td>${subject}</td>
                    <td>${data.correct}</td>
                    <td>${data.wrong}</td>
                    <td>${data.blank}</td>
                    <td>${data.total}</td>
                    <td>${data.marks}</td>
                </tr>
            `).join('')}
        </tbody>
    `;
    
    document.getElementById('summaryTableContainer').innerHTML = '';
    document.getElementById('summaryTableContainer').appendChild(table);
    
    document.getElementById('closeSummaryBtn').onclick = () => {
        document.getElementById('summaryArea').style.display = 'none';
        document.getElementById('studentEntry').style.display = 'flex';
        resetForm();
    };
}

// ===== UTILITY FUNCTIONS =====
function resetForm() {
    document.getElementById('stuName').value = '';
    document.getElementById('stuSection').value = '';
    document.getElementById('stuRoll').value = '';
    document.getElementById('stuAdm').value = '';
    validateStudentInputs();
}

function showConfirm(message, callback) {
    if (confirm(message)) {
        callback(true);
    } else {
        callback(false);
    }
}

// ===== EVENT LISTENERS =====
document.getElementById('verifyAccess').addEventListener('click', verifyAccessCode);
document.getElementById('accessCode').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') verifyAccessCode();
});

["stuName", "stuSection", "stuRoll", "stuAdm"].forEach(id => {
    document.getElementById(id).addEventListener("input", validateStudentInputs);
});

document.getElementById('stuStartBtn').onclick = () => { 
    if (!validateStudentInputs()) return; 
    showConfirm("Start Exam? Full-screen mode will be enabled.", startExamWithSecurity); 
};

document.getElementById('submitBtn').onclick = () => {
    showConfirm("Submit Exam? You cannot change answers after submission.", submitExam);
};

document.getElementById('returnToFullscreen').addEventListener('click', function() {
    examSecurity.requestFullScreen();
});

// ===== INITIALIZATION =====
window.addEventListener('load', function() {
    console.log('LFJC Online Exam System Initialized');
    
    // Show access denied screen first
    document.getElementById('accessDenied').style.display = 'flex';
    document.getElementById('studentEntry').style.display = 'none';
    document.getElementById('examArea').style.display = 'none';
    document.getElementById('summaryArea').style.display = 'none';
    
    document.getElementById('accessCode').focus();
});

// ===== BLOCK SHORTCUTS =====
document.addEventListener('keydown', function(e) {
    if (examInProgress) {
        // Block developer tools
        if (e.keyCode === 123 || 
            (e.ctrlKey && e.shiftKey && e.keyCode === 73) ||
            (e.ctrlKey && e.shiftKey && e.keyCode === 74) ||
            (e.ctrlKey && e.keyCode === 85)) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    }
});

console.log("‚úÖ LFJC Secure Online Exam System Loaded");
console.log("üîí Full-screen security system active");
</script>
</body>
</html>
